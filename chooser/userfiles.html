<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>DCS Userfiles</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <link rel="icon" href="https://www.digitalcombatsimulator.com/images/favicon.ico">
        <style type="text/css">
            .card {
                max-height: 400px;
                overflow-y: auto;
            }
            .row > div {
                margin-bottom: 20px;
            }
            .flex-container {
                display: flex;
                align-items: flex-start;
            }
            .img-container {
                width: 200px;
                height: 100px;
                overflow: hidden;
                position: relative;
                margin-right: 10px;
            }
            .img-container img {
                width: 100%;
                height: 100%;
                object-fit: cover;
                position: absolute;
            }
            .text-container {
                flex: 1;
            }
            .full-width {
                width: 100%;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>DCS Userfiles</h1>
            <div id="filter" class="row">
                <div class="col-3">
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" placeholder="Search" aria-label="Search">
                    </div>
                </div>
                <div class="col-3">
                    <select class="form-select" id="typeSelect">
                        <option value="">All Types</option>
                        <!-- Add options for types dynamically or statically here -->
                    </select>
                </div>
                <div class="col-3">
                    <select class="form-select" id="languageSelect">
                        <option value="">All Languages</option>
                        <!-- Add options for languages dynamically or statically here -->
                    </select>
                </div>
                <div class="col-3">
                    <select class="form-select" id="unitSelect">
                        <option value="">All Units</option>
                        <!-- Add options for units dynamically or statically here -->
                    </select>
                </div>
            </div>
            <div id="results" class="row">
            </div>
        </div>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script>
            $.getJSON("userfiles.json", function(data) {
                window.userfiles = data;
                populateSelectBoxes(data);
            });

            function populateSelectBoxes(data) {
                var types = new Set();
                var languages = new Set();
                var units = new Set();

                data.forEach(function(userfile) {
                    types.add(userfile.type);
                    languages.add(userfile.language);
                    units.add(userfile.unit);
                });

                populateSelectBox("#typeSelect", types);
                populateSelectBox("#languageSelect", languages);
                populateSelectBox("#unitSelect", units);
            }

            function populateSelectBox(selector, items) {
                var selectBox = $(selector);
                items.forEach(function(item) {
                    selectBox.append($('<option>', { value: item, text: item }));
                });
            }

            function filter() {
                var search = $("input").val().split(" ");
                var type = $("#typeSelect").val();
                var language = $("#languageSelect").val();
                var unit = $("#unitSelect").val();

                var results = [];
                var maxResults = 100;
                var nResults = 0;

                for (var i = 0; i < window.userfiles.length && nResults < maxResults; i++) {
                    var userfile = window.userfiles[i];
                    var match = true;

                    for (var j = 0; j < search.length; j++) {
                        if (!userfile.title.toLowerCase().includes(search[j].toLowerCase())
                            && !userfile.description.toLowerCase().includes(search[j].toLowerCase())
                            && !userfile.author.toLowerCase().includes(search[j].toLowerCase())
                            && !userfile.tags.join(" ").toLowerCase().includes(search[j].toLowerCase())
                            && !userfile.game.toLowerCase().includes(search[j].toLowerCase())
                            && !userfile.unit.toLowerCase().includes(search[j].toLowerCase())
                            && !userfile.type.toLowerCase().includes(search[j].toLowerCase())
                        ) {
                            match = false;
                            break;
                        }
                    }

                    if (type && userfile.type !== type) match = false;
                    if (language && userfile.language !== language) match = false;
                    if (unit && userfile.unit !== unit) match = false;

                    if (match) {
                        nResults++;
                        results.push(userfile);
                    }
                }

                var html = "";
                for (var i = 0; i < results.length; i++) {
                    var userfile = results[i];
                    html += "<div class='col-md-6'>";
                    html += "<div class='card'>";
                    html += "<div class='card-header'>" + "<a href='" + userfile.downloadlink + "'>" + userfile.title + "</a>" + "</div>";
                    html += "<div class='card-body'>";
                    html += "<div class='flex-container'>";
                    html += "<div class='img-container'><img src='https://www.digitalcombatsimulator.com/" + userfile.image + "'></div>";
                    html += "<div class='text-container'>";
                    html += "<p>";
                    html += "<b>" + userfile.type + "</b> ";
                    html += "by <b>" + userfile.author + "</b> ";
                    html += " from <b>" + userfile.date + "</b><br>";
                    html += "(" + userfile.game + ", " + userfile.unit + ")";
                    html += "</p>";
                    html += "</div>";
                    html += "</div>";
                    html += "<div class='full-width'>";
                    html += "<p><b>Description:</b> " + userfile.description + "</p>";
                    html += "<p>";
                    html += "<b>License:</b> " + userfile.license + "<br>";
                    html += "<b>Language:</b> " + userfile.language + "<br>";
                    html += "<b>Size:</b> " + userfile.size + "<br>";
                    html += "<b>Downloaded:</b> " + userfile.downloaded + "<br>";
                    html += "<b>Comments:</b> " + userfile.comments + "<br>";
                    html += "</p>";
                    html += "<p><b>Tags:</b> " + userfile.tags.join(", ") + "</p>";
                    html += "</div>";
                    html += "</div>";
                    html += "</div>";
                    html += "</div>";
                }
                $("#results").html(html);
            }

            $(document).ready(function() {
                $("input").keyup(function() {
                    clearTimeout(this.delay);
                    this.delay = setTimeout(filter, 200);
                });

                $("#typeSelect, #languageSelect, #unitSelect").change(function() {
                    filter();
                });
            });
        </script>
    </body>
</html>
